# 视频脚本生成功能设计

> **For AI Agent**: 阅读此文档了解如何基于爆款视频分析结果，生成可执行的视频制作脚本。

---

## 1. 功能概述

### 1.1 背景与目标

当前视频分析功能已能输出：主题、情感、营销价值、关键话题等**内容层面**的分析。

**缺失的能力**：无法告诉用户"这个视频是怎么拍出来的"，无法复刻。

**本功能目标**：
- 输入：爆款视频 + 基础分析结果
- 输出：可执行的视频制作脚本（分镜头 + 音乐卡点 + 制作指南）

### 1.2 核心价值

```
爆款视频 → 深度拆解 → 生成制作脚本 → 人工微调 → 复刻/创作新视频
```

让用户可以：
1. **直接照搬** - 换个产品/场景，复刻成功模式
2. **微调优化** - 保留爆款结构，注入自己的创意
3. **批量生产** - 形成可复制的爆款公式

---

## 2. 数据结构设计

### 2.1 输出 JSON Schema

```json
{
  "script_version": "1.0",
  "video_info": {
    "original_url": "string",
    "duration": "number (秒)",
    "author": "string",
    "title": "string"
  },
  "success_formula": {
    "hook_type": "string (开头钩子类型)",
    "hook_description": "string (钩子具体描述)",
    "content_structure": "string (内容结构: 问题-解决/故事-反转/教程-演示等)",
    "emotional_arc": "string (情绪曲线描述)",
    "key_success_factors": ["string (爆款关键因素列表)"]
  },
  "storyboard": [
    {
      "shot_number": "number",
      "time_start": "string (MM:SS)",
      "time_end": "string (MM:SS)",
      "duration": "number (秒)",
      "shot_type": "string (特写/中景/全景/运镜等)",
      "visual_description": "string (画面内容描述)",
      "script_text": "string (文案/旁白/字幕)",
      "action_description": "string (人物动作描述)",
      "camera_movement": "string (镜头运动: 推/拉/摇/移/跟/固定)",
      "transition": "string (转场效果: 硬切/淡入淡出/滑动等)",
      "emotion": "string (该镜头的情绪基调)",
      "notes": "string (拍摄注意事项)"
    }
  ],
  "music_beats": {
    "music_style": "string (音乐风格建议)",
    "bpm_range": "string (建议BPM范围)",
    "beat_points": [
      {
        "time": "string (MM:SS)",
        "action": "string (卡点动作: 切镜头/特效/文字弹出等)",
        "description": "string (具体描述)"
      }
    ]
  },
  "reusable_elements": {
    "opening_hook": {
      "technique": "string (开场技巧)",
      "example": "string (原视频示例)",
      "how_to_adapt": "string (如何套用到新视频)"
    },
    "engagement_triggers": [
      {
        "trigger_type": "string (互动触发点类型)",
        "original_example": "string (原视频示例)",
        "adaptation_tip": "string (改编建议)"
      }
    ],
    "call_to_action": {
      "cta_type": "string (CTA类型)",
      "original_text": "string (原文案)",
      "template": "string (可复用模板)"
    }
  },
  "production_guide": {
    "equipment_needed": ["string (所需设备清单)"],
    "preparation_steps": [
      {
        "step": "number",
        "description": "string",
        "details": "string"
      }
    ],
    "shooting_tips": ["string (拍摄技巧提示)"],
    "editing_tips": ["string (剪辑技巧提示)"],
    "estimated_production_time": "string (预计制作时长)"
  }
}
```

### 2.2 数据库字段扩展

在现有 `video_analysis` 表基础上，新增字段或关联表：

```sql
-- 方案A: 直接在现有表新增 JSONB 字段
ALTER TABLE video_analysis
ADD COLUMN production_script JSONB;

-- 方案B: 新建关联表（推荐，便于独立管理）
CREATE TABLE video_production_scripts (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  video_analysis_id UUID REFERENCES video_analysis(id),
  script_data JSONB NOT NULL,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

---

## 3. Prompt 设计

### 3.1 脚本生成主 Prompt

```markdown
你是一位专业的短视频制作导演和编剧，擅长分析爆款视频并生成可执行的制作脚本。

## 你的任务

基于以下视频分析结果，生成一份详细的视频制作脚本，让用户可以复刻或改编这个爆款视频。

## 输入信息

### 视频基本信息
- URL: {{video_url}}
- 时长: {{duration}}秒
- 作者: {{author}}
- 标题: {{title}}

### 已有分析结果
{{existing_analysis}}

## 输出要求

请严格按照以下 JSON 格式输出，确保每个字段都有值：

### 1. 爆款公式分析 (success_formula)
- 分析这个视频的开头钩子是什么类型（悬念型/冲突型/利益型/好奇型/共鸣型）
- 分析内容结构（问题-解决/故事-反转/教程-演示/对比-选择等）
- 分析情绪曲线（平稳/递进/过山车/先抑后扬等）
- 列出3-5个关键成功因素

### 2. 分镜头脚本 (storyboard)
为每个镜头提供：
- 镜头编号和时间点（精确到秒）
- 景别（特写/中景/全景）
- 画面内容（具体描述看到什么）
- 文案/旁白（如果有）
- 动作描述（人物在做什么）
- 镜头运动（推/拉/摇/移/跟/固定）
- 转场方式
- 情绪基调
- 拍摄注意事项

### 3. 音乐节奏卡点 (music_beats)
- 建议的音乐风格
- BPM范围
- 关键卡点时刻（精确到秒）及对应动作

### 4. 可复用元素 (reusable_elements)
- 开场钩子技巧（原示例 + 如何改编）
- 互动触发点（原示例 + 改编建议）
- CTA模板

### 5. 制作指南 (production_guide)
- 所需设备清单
- 准备步骤（按顺序）
- 拍摄技巧提示
- 剪辑技巧提示
- 预计制作时长

## 注意事项

1. 分镜头要足够详细，让没看过原视频的人也能照着拍
2. 时间点必须精确，与原视频时长匹配
3. 可复用元素要给出具体的改编方法，不要空泛
4. 制作指南要实用，考虑普通创作者的设备条件

## 输出格式

直接输出 JSON，不要添加任何解释文字。
```

### 3.2 Prompt 变体：简化版（快速生成）

```markdown
你是短视频制作专家。基于以下视频分析，快速生成制作脚本要点。

## 视频信息
{{video_info}}

## 分析结果
{{analysis}}

## 请输出

1. **爆款公式**（一句话总结）
2. **分镜头表**（简化版，5-8个关键镜头）
3. **音乐建议**（风格 + 3个关键卡点）
4. **复刻要点**（3条最重要的建议）

输出 JSON 格式。
```

### 3.3 Prompt 变体：针对特定品类

```markdown
你是{{category}}领域的短视频制作专家。

## 品类特点
{{category_specific_tips}}

## 视频分析
{{analysis}}

## 请生成适合{{category}}品类的制作脚本

重点关注：
- 产品展示的最佳镜头设计
- 该品类用户的痛点触发方式
- 行业常用的爆款套路

输出标准 JSON 格式脚本。
```

---

## 4. 输出样例

### 4.1 完整输出示例

```json
{
  "script_version": "1.0",
  "video_info": {
    "original_url": "https://www.tiktok.com/@garagetoolguy/video/7590932758877310221",
    "duration": 15,
    "author": "garagetoolguy",
    "title": "野生动物服装展示"
  },
  "success_formula": {
    "hook_type": "好奇型",
    "hook_description": "以野生动物与人类服装的反差画面开场，瞬间抓住注意力",
    "content_structure": "展示-反转-共鸣",
    "emotional_arc": "惊奇→好奇→温馨→会心一笑",
    "key_success_factors": [
      "野生动物与人类服装的强烈反差",
      "非洲草原的异域场景",
      "动物的真实反应增加趣味性",
      "简短精炼，15秒内完成叙事",
      "利用观众对动物的天然好感"
    ]
  },
  "storyboard": [
    {
      "shot_number": 1,
      "time_start": "00:00",
      "time_end": "00:03",
      "duration": 3,
      "shot_type": "全景",
      "visual_description": "非洲草原背景，一个人穿着带帽服装站在草地上",
      "script_text": "For a moment there, I thought it was all over...",
      "action_description": "人物静止站立，镜头缓慢推近",
      "camera_movement": "缓推",
      "transition": "硬切",
      "emotion": "悬念、紧张",
      "notes": "开场3秒是黄金时间，必须有视觉冲击"
    },
    {
      "shot_number": 2,
      "time_start": "00:03",
      "time_end": "00:06",
      "duration": 3,
      "shot_type": "中景",
      "visual_description": "镜头揭示原来是两只土狼在观察穿着服装的人",
      "script_text": "",
      "action_description": "土狼警惕地观察，偶尔转头",
      "camera_movement": "固定",
      "transition": "硬切",
      "emotion": "揭示、好奇",
      "notes": "这是反转点，要让观众'原来如此'"
    },
    {
      "shot_number": 3,
      "time_start": "00:06",
      "time_end": "00:10",
      "duration": 4,
      "shot_type": "特写+中景交替",
      "visual_description": "土狼的表情特写，与服装细节交替展示",
      "script_text": "",
      "action_description": "土狼表现出警惕和好奇的混合表情",
      "camera_movement": "快速切换",
      "transition": "快切",
      "emotion": "趣味、可爱",
      "notes": "动物表情是吸引互动的关键"
    },
    {
      "shot_number": 4,
      "time_start": "00:10",
      "time_end": "00:15",
      "duration": 5,
      "shot_type": "全景",
      "visual_description": "拉远镜头，展示人与土狼和谐共处的画面",
      "script_text": "#Wildlife #NatureDocumentary #LawsOfTheSavanna",
      "action_description": "土狼渐渐放松，场景趋于和谐",
      "camera_movement": "缓拉",
      "transition": "淡出",
      "emotion": "温馨、治愈",
      "notes": "结尾要留下正面情绪，促进分享"
    }
  ],
  "music_beats": {
    "music_style": "轻快神秘风格，带有非洲元素的打击乐",
    "bpm_range": "100-120 BPM",
    "beat_points": [
      {
        "time": "00:00",
        "action": "音乐起，低沉悬疑音效",
        "description": "配合开场悬念氛围"
      },
      {
        "time": "00:03",
        "action": "鼓点落下，切换镜头",
        "description": "反转揭示时刻，音乐转明快"
      },
      {
        "time": "00:06",
        "action": "节奏加快，配合快切",
        "description": "动物特写与产品展示交替"
      },
      {
        "time": "00:10",
        "action": "音乐渐弱，温馨旋律",
        "description": "结尾收束，情绪归于平静"
      },
      {
        "time": "00:14",
        "action": "音乐淡出",
        "description": "留白结束"
      }
    ]
  },
  "reusable_elements": {
    "opening_hook": {
      "technique": "悬念开场 + 反差设定",
      "example": "野生动物与人类服装的反常组合",
      "how_to_adapt": "找到你的产品与某个意外场景的反差点。例如：户外装备可以放到极端环境测试，美妆产品可以在运动后展示持妆效果"
    },
    "engagement_triggers": [
      {
        "trigger_type": "动物/萌宠元素",
        "original_example": "土狼的警惕与好奇表情",
        "adaptation_tip": "如果无法使用野生动物，可用宠物替代。宠物对产品的反应往往能带来高互动"
      },
      {
        "trigger_type": "异域场景",
        "original_example": "非洲草原",
        "adaptation_tip": "选择具有辨识度的场景背景，增加视觉记忆点"
      },
      {
        "trigger_type": "故事性文案",
        "original_example": "For a moment there, I thought it was all over...",
        "adaptation_tip": "用第一人称制造紧张感，让观众代入"
      }
    ],
    "call_to_action": {
      "cta_type": "标签引导型",
      "original_text": "#Wildlife #NatureDocumentary #LawsOfTheSavanna",
      "template": "#[主题关键词] #[情感关键词] #[品类关键词]"
    }
  },
  "production_guide": {
    "equipment_needed": [
      "智能手机或相机（支持4K更佳）",
      "三脚架或稳定器",
      "外置麦克风（如需录制现场音）",
      "产品/服装道具",
      "剪辑软件（剪映/Premiere/Final Cut）"
    ],
    "preparation_steps": [
      {
        "step": 1,
        "description": "选择拍摄场景",
        "details": "找一个有辨识度的户外场景，如公园、郊外、特色建筑前"
      },
      {
        "step": 2,
        "description": "准备产品/道具",
        "details": "确保产品整洁、状态最佳，准备多个备选"
      },
      {
        "step": 3,
        "description": "设计反差点",
        "details": "思考如何将产品与场景结合出意外感"
      },
      {
        "step": 4,
        "description": "编写简短文案",
        "details": "准备1-2句悬念开场文案"
      },
      {
        "step": 5,
        "description": "选择背景音乐",
        "details": "在剪辑软件中预选3-5首候选音乐"
      }
    ],
    "shooting_tips": [
      "开场3秒必须有视觉冲击，可以用反差、悬念、动态画面",
      "保持镜头稳定，使用三脚架或稳定器",
      "多拍素材，同一镜头拍3-5次备选",
      "注意自然光线，黄金时段（早晨/傍晚）拍摄效果最佳",
      "如有动物/宠物参与，需要耐心等待自然反应"
    ],
    "editing_tips": [
      "遵循音乐节奏剪辑，关键动作卡在节拍上",
      "前3秒决定观众是否继续看，反复打磨开头",
      "镜头切换不要太快也不要太慢，2-4秒一个镜头为宜",
      "字幕要简洁，使用高对比度颜色",
      "结尾留0.5-1秒空白，给观众反应时间"
    ],
    "estimated_production_time": "拍摄1-2小时，剪辑2-3小时，总计半天"
  }
}
```

---

## 5. API 接口设计

### 5.1 生成脚本接口

```
POST /api/v1/generate-script
```

**请求体：**
```json
{
  "video_analysis_id": "uuid",  // 已有分析结果的ID
  "script_type": "full|simple",  // 完整版或简化版
  "category": "string (可选，品类)"  // 用于加载品类特定prompt
}
```

**响应体：**
```json
{
  "task_id": "string",
  "status": "pending|processing|completed|failed",
  "script": { ... }  // 完成后返回脚本JSON
}
```

### 5.2 获取脚本接口

```
GET /api/v1/script/{video_analysis_id}
```

**响应体：**
```json
{
  "script_id": "uuid",
  "video_analysis_id": "uuid",
  "script_data": { ... },
  "created_at": "timestamp",
  "updated_at": "timestamp"
}
```

---

## 6. 实施计划

### 6.1 后端任务

| 序号 | 任务 | 优先级 | 说明 |
|------|------|--------|------|
| 1 | 创建 `video_production_scripts` 表 | P0 | 数据存储基础 |
| 2 | 实现脚本生成 Prompt 模板 | P0 | 核心逻辑 |
| 3 | 新增 `/generate-script` API | P0 | 触发脚本生成 |
| 4 | 新增 `/script/{id}` API | P0 | 获取脚本 |
| 5 | 集成到现有分析流程（可选自动生成） | P1 | 用户体验优化 |
| 6 | 添加品类特定 Prompt 模板 | P2 | 提升特定品类准确度 |

### 6.2 前端任务

| 序号 | 任务 | 优先级 | 说明 |
|------|------|--------|------|
| 1 | 脚本展示组件 | P0 | 分镜头表格、时间线可视化 |
| 2 | 音乐卡点可视化 | P1 | 配合视频播放显示卡点 |
| 3 | 脚本导出功能 | P1 | 导出为 PDF/Markdown |
| 4 | 脚本编辑功能 | P2 | 用户微调后保存 |

### 6.3 文件位置规划

```
backend/
├── skills/
│   └── script_generator/
│       ├── __init__.py
│       ├── generator.py          # 脚本生成核心逻辑
│       ├── prompts/
│       │   ├── full_script.txt   # 完整版prompt
│       │   ├── simple_script.txt # 简化版prompt
│       │   └── category/         # 品类特定prompt
│       └── schemas.py            # Pydantic模型定义

frontend/
├── src/
│   └── themes/default/blocks/
│       └── tiktok/
│           ├── script-viewer.tsx      # 脚本查看器
│           ├── storyboard-table.tsx   # 分镜头表格
│           ├── beat-timeline.tsx      # 卡点时间线
│           └── script-export.tsx      # 导出功能
```

---

## 7. 验收标准

### 7.1 功能验收

- [ ] 输入视频分析ID，能生成完整脚本
- [ ] 分镜头时间点与原视频时长匹配
- [ ] 音乐卡点精确到秒
- [ ] 可复用元素包含具体改编建议
- [ ] 制作指南具有可操作性

### 7.2 质量验收

- [ ] JSON 输出格式稳定，无字段缺失
- [ ] 分镜头描述足够详细，非专业人士可理解
- [ ] 制作指南考虑普通创作者设备条件
- [ ] 响应时间 < 30秒

---

*文档版本：1.0*
*创建时间：2025-02-02*
*最后更新：2025-02-02*
