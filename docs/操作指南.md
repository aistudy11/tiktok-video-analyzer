# TikTok 视频分析器 - 操作指南

## 系统架构

```
iPhone/手机 → FastAPI Gateway → Celery Worker → AI分析 → 飞书多维表格
     ↓              ↓                ↓              ↓            ↓
  快捷指令      接收请求         后台处理      Gemini AI    保存结果
```

---

## 一、系统访问地址

| 服务 | 地址 |
|------|------|
| API 接口 | `https://tiktok-api.thumbmaker.ai` |
| API 文档 | `https://tiktok-api.thumbmaker.ai/docs` |
| 健康检查 | `https://tiktok-api.thumbmaker.ai/health` |
| 飞书多维表格 | `https://my.feishu.cn/base/Xxz8bFHNdapRPfsFNEDczbgYnEb` |

---

## 二、手机端操作流程

### 方式一：使用 iOS 快捷指令（推荐）

#### 步骤 1：创建快捷指令

1. 打开 iPhone 的「快捷指令」App
2. 点击右上角 `+` 创建新快捷指令
3. 添加以下操作：

```
操作1: 接收「共享表单」的输入
       - 接受: URL

操作2: 获取 URL
       - URL: https://tiktok-api.thumbmaker.ai/api/v1/analyze
       - 方法: POST
       - 请求体: JSON
       - JSON内容:
         {
           "url": "[快捷指令输入]",
           "sync_to_feishu": true
         }
       - 请求头:
         Content-Type: application/json

操作3: 显示通知
       - 标题: 视频分析已提交
       - 内容: 任务已创建，稍后可在飞书查看结果
```

4. 保存快捷指令，命名为「分析TikTok视频」

#### 步骤 2：使用快捷指令

1. 打开 TikTok App，找到要分析的视频
2. 点击「分享」按钮
3. 选择「更多」→「快捷指令」→「分析TikTok视频」
4. 等待提示「任务已创建」

---

### 方式二：直接调用 API

#### 提交分析任务

```bash
curl -X POST "https://tiktok-api.thumbmaker.ai/api/v1/analyze" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://www.tiktok.com/@username/video/1234567890",
    "sync_to_feishu": true
  }'
```

**响应示例：**
```json
{
  "task_id": "abc123-def456-ghi789",
  "status": "pending",
  "message": "Task created successfully"
}
```

#### 查询任务状态

```bash
curl "https://tiktok-api.thumbmaker.ai/api/v1/tasks/{task_id}"
```

**响应示例：**
```json
{
  "task_id": "abc123-def456-ghi789",
  "status": "completed",
  "progress": 100,
  "result": {
    "video_title": "视频标题",
    "author": "作者名",
    "ai_analysis": "AI分析结果...",
    "content_summary": "内容摘要..."
  }
}
```

---

## 三、任务处理流程

当你提交一个视频URL后，系统会按以下步骤处理：

```
1. 接收请求 (0%)
   ↓
2. 下载视频 (10% → 30%)
   - 使用 Playwright 从 TikTok 下载视频
   - 提取视频元数据（标题、作者、时长等）
   ↓
3. AI 分析 (40% → 70%)
   - 使用 Gemini AI 分析视频内容
   - 生成内容摘要、关键话题、情感分析等
   ↓
4. 同步到飞书 (80% → 100%)
   - 将分析结果写入飞书多维表格
   - 上传视频缩略图
   ↓
5. 完成
```

---

## 四、查看分析结果

### 在飞书多维表格中查看

1. 打开飞书 App 或网页版
2. 访问多维表格：`https://my.feishu.cn/base/Xxz8bFHNdapRPfsFNEDczbgYnEb`
3. 查看最新添加的记录

### 表格字段说明

| 字段名 | 说明 |
|--------|------|
| 任务ID | 唯一标识符 |
| 视频URL | 原始TikTok链接 |
| 视频标题 | 视频的标题 |
| 作者 | 视频发布者 |
| 时长 | 视频时长（秒） |
| AI分析 | Gemini AI 的详细分析 |
| 内容摘要 | 视频内容的简短摘要 |
| 关键话题 | 提取的关键词/标签 |
| 情感倾向 | 正面/中性/负面 |
| 创建时间 | 分析任务创建时间 |

---

## 五、API 接口文档

### 1. 健康检查

```
GET /health
```

### 2. 提交分析任务

```
POST /api/v1/analyze
```

**请求体：**
```json
{
  "url": "TikTok视频URL（必填）",
  "analysis_prompt": "自定义分析提示（可选）",
  "sync_to_feishu": true,
  "callback_url": "回调通知URL（可选）"
}
```

### 3. 查询任务状态

```
GET /api/v1/tasks/{task_id}
```

### 4. 获取任务列表

```
GET /api/v1/tasks?limit=10&offset=0
```

---

## 六、常见问题

### Q1: 提交任务后多久能看到结果？

通常 1-3 分钟，取决于：
- 视频大小和下载速度
- AI 分析复杂度
- 飞书 API 响应速度

### Q2: 支持哪些视频链接格式？

- `https://www.tiktok.com/@username/video/123456`
- `https://vm.tiktok.com/xxxxx/`（短链接）
- `https://vt.tiktok.com/xxxxx/`（短链接）

### Q3: 分析失败怎么办？

1. 检查视频链接是否有效
2. 确认视频是否为公开视频
3. 查看任务状态中的错误信息
4. 重新提交任务

### Q4: 如何查看任务进度？

```bash
curl "https://tiktok-api.thumbmaker.ai/api/v1/tasks/{task_id}"
```

返回的 `progress` 字段表示进度百分比。

---

## 七、系统配置信息

### 环境变量

| 变量名 | 说明 |
|--------|------|
| `GEMINI_API_KEY` | Gemini AI API密钥 |
| `GEMINI_BASE_URL` | API代理地址 |
| `FEISHU_APP_ID` | 飞书应用ID |
| `FEISHU_APP_SECRET` | 飞书应用密钥 |
| `FEISHU_BITABLE_APP_TOKEN` | 多维表格Token |
| `FEISHU_BITABLE_TABLE_ID` | 数据表ID |

### 服务组件

| 组件 | 说明 |
|------|------|
| Gateway | FastAPI 网关服务，处理 HTTP 请求 |
| Celery Worker | 后台任务处理器 |
| Celery Beat | 定时任务调度器 |
| Redis | 消息队列和缓存 |

---

## 八、快速开始示例

### 完整操作流程演示

```bash
# 1. 检查服务状态
curl https://tiktok-api.thumbmaker.ai/health
# 返回: {"status":"healthy"}

# 2. 提交分析任务
curl -X POST "https://tiktok-api.thumbmaker.ai/api/v1/analyze" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.tiktok.com/@example/video/123", "sync_to_feishu": true}'
# 返回: {"task_id": "xxx", "status": "pending"}

# 3. 查询任务状态（等待几秒后）
curl "https://tiktok-api.thumbmaker.ai/api/v1/tasks/xxx"
# 返回: {"status": "completed", "progress": 100, "result": {...}}

# 4. 打开飞书多维表格查看结果
# https://my.feishu.cn/base/Xxz8bFHNdapRPfsFNEDczbgYnEb
```

---

## 九、联系与支持

- **GitHub**: https://github.com/aistudy11/tiktok-video-analyzer
- **API文档**: https://tiktok-api.thumbmaker.ai/docs

---

*最后更新: 2026-01-24*
